<?php
	//PREGUNTAR PORQUE NO VA

	//Conectamos BD
	$link = mysql_connect('localhost', 'root', 'root') or die('No se pudo conectar: ' . mysql_error());
				echo 'Connected successfully';
				
		mysql_select_db('proyecto') or die('No se pudo seleccionar la base de datos');
		
		
		//obtenemos el correo  y la contraseña:
		$mail = trim($_POST['correo']);
		$pass = trim($_POST['contra']);
		
		//variable que define que el correo existe, si es 0 no existe.
		$findmail = 0;
		
		//comprobamos al existencia del email en la BD:
		$query = "select password FROM cliente WHERE mail = '$mail'";
		
		//lanzamos consulta para insertar los datos en la BD;
		
		$res = mysql_query($query) or die('Consulta fallida: ' . mysql_error());
		
		if (mysql_num_rows($res) <= 0){
			echo "No existe registro";
			return false;
		}
		else if($pass != mysql_result($res, 0, "password")){
			echo "Contraseña invalida";
			return FALSE;
		}
		else {
			echo "Conected succefull";
		} 	
		
		/*
		$filas = mysql_num_rows($res);
	
	
	
		if ($filas != 0) {
			for ($i = 0; $i < $filas; $i++) {
				$correo[$i] = mysql_result($res, $i, "email");
				if ($mail == $correo[$i]) {
					//el correo existe
					$findmail = 1;
				}
				else{
					//mensaje en el caso de que el correo no exista.
					echo "Correo o contraseña no coinciden con un usuario registrado";
					return false;
				}
			}
		}
		
		//Si el correo existe se realiza otra consulta para averiguar la coincidencia de la contraseña
		if ($findmail == 1) {
			$query2 = "SELECT password FROM cliente WHERE email = '$mail'";
			$res2 = mysql_query($query2) or die('Consulta fallida: ' . mysql_error());
			$filas2 = mysql_num_rows($res2);
			if ($filas != 0) {
				for ($i = 0; $i < $filas2; $i++) {
					$contra[$i] = mysql_result($res, $i, "password");
					//mensaje en el caso de que la contraseña no coincida.
					if ($pass != $contra[$i]) {
						echo "Correo o contraseña no coinciden con un usuario registrado";
						return FALSE;
					}
					else {
						//Iniciar sesion
						//TODO incorporar las variables de sesion para logear correctamente en la pagina.
						header("location: novedades.php");
					}
				}
			}
		}
		*/
?>